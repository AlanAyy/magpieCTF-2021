FROM nsjailcontainer

ARG USERNAME=magpie
RUN useradd -m $USERNAME
RUN chmod a-w /home/$USERNAME

COPY chain_my_song /home/magpie/chain_my_song
COPY flag.txt /home/magpie/flag.txt

RUN chmod o+x /home/magpie/chain_my_song

EXPOSE 1982

CMD ["/bin/nsjail",			\
        "-Ml",				\
        "--hostname", "host",		\
        "--port", "1982",		\
        "--user", "1001",		\
        "--group", "1001",		\
        "--chroot", "/",		\
        "-E", "TERM=xterm",		\
        "--cwd", "/home/magpie",	\
        "--",				\
        "/home/magpie/chain_my_song"		\
    ]
