/* gcc -m32 flush.c -o flush -fno-stack-protector -Wno-deprecated-declarations -std=c90 -D_FORTIFY_SOURCE=0 -no-pie -fno-pic
Arch:     i386-32-little
RELRO:    Partial RELRO
Stack:    No canary found
NX:       NX enabled
PIE:      No PIE (0x8048000)
*/
#include <stdio.h>
#include <stdlib.h>

void win(unsigned int pipe0, unsigned int pipe1, unsigned int pipe2)
{
	char flag[48];
	FILE *file = fopen("flag.txt", "r");
	if (file == NULL) {
		puts("Flag File is Missing.");
		exit(0);
	}
	fgets(flag, sizeof(flag), file);

	if (pipe0 == 0xE91C && pipe1 == 0xB055 && pipe2 == 0xBA771E)
	{
		fputs("\nCongrats Mario! You navigated the pipes correctly to find the princess!\n", stdout);
		fputs("Here's your flag: ", stdout);
		fputs(flag, stdout);
	}
}

/* NOTE: A good plumber always cleans up. */
void vuln()
{
	char buf[8];
	fputs("Where to? : ", stdout);
	fflush(stdout);

	gets(buf);
}

int main(void)
{
	setvbuf(stdout, NULL, _IOFBF, 0);

	puts("Hello Mario - Navigate the pipes to find the princess... IF YOU DARE!");
	fflush(stdout);

	vuln();
    return 0;
}