FROM nsjailcontainer

ARG USERNAME=magpie
RUN useradd -m $USERNAME
RUN chmod a-w /home/$USERNAME

COPY ret2jedi /home/magpie/ret2jedi
COPY flag.txt /home/magpie/flag.txt
COPY libc.so.6 /home/magpie/libc.so.6
COPY ld-linux-x86-64.so.2 /home/magpie/ld-linux-x86-64.so.2
RUN chmod o+x /home/magpie/ret2jedi

EXPOSE 6600

CMD ["/bin/nsjail",			\
        "-Ml",				\
        "--hostname", "host",		\
        "--port", "6600",		\
        "--user", "1001",		\
        "--group", "1001",		\
        "--chroot", "/",		\
        "-E", "TERM=xterm",		\
        "--cwd", "/home/magpie",	\
        "--",				\
        "/home/magpie/ret2jedi"		\
    ]
