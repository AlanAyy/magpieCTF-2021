<?php 
$cookiename = 'member';
$cookievalue = 'none';

if (!isset($_COOKIE['member'])){
    setcookie($cookiename, $cookievalue);    
}

$servername = "localhost";
$username = "root";
$password = "";
$dbname = "collectors_club";

$conn = new mysqli($servername, $username, $password, $dbname);
if ($conn->connect_error){
    die("Connection failed: " . $conn->connect_error);
}

?>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collector's Club</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="css/custom.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js" integrity="sha384-OgVRvuATP1z7JjHLkuOU7Xw704+h835Lr+6QL9UvYjZE3Ipu6Tp75j7Bh/kR0JKI" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.bundle.min.js" integrity="sha384-1CmrxMRARb6aLqgBO7yyAxTOQE2AKb9GfXnEo760AUcUmFx3ibVJJAzGytlQcNXd" crossorigin="anonymous"></script>
    
    
</head>
<body>

    <div class="container" >
        <div class="row">
            <div class="col-sm">
                <h1>Apply to join Collectors Club</h1>
                <div class="container">
                <p>Thanks for showing interest in the Collectors Club. 
                We are looking for someone who knows how to write HTML and Javascript. 
                So we opened up applications for you to show off your mad HTML skillz and prove why we should add you to the Club!
                The guy we hired to maintain the site left us in the lurch, and now we really need some help around here. 
                In fact, we don't even have the time to make the application page look all nice! 
                We've been looking for someone since last September and we're getting kinda desperate. So apply today!</p>
                <p>Sincerely, the Collectors Club</p>
                </div>

                <div class="container">
                    <form action="application.php" method="POST">

                        <div class="form-group">
                            <textarea name="resume" id="resume" class="form-control" cols="30" rows="10" placeholder="Write your HTML Resume here!" required></textarea>
                        </div>

                    <button class="btn btn-secondary" id="submitButton">Review Application</button>    
                    </form>
                    
                </div>
            </div>
    </div>

    <?php 
    // respond to POST request on submission button
    if (isset($_POST["resume"])){
        $content = addslashes($_POST["resume"]);

        // generate unique id code for submission 
        $content_uuid = uniqid();

        // insert record into database 
        $sql = "INSERT INTO resumes (uuid, content) VALUES('$content_uuid', '$content')";
        if (mysqli_query($conn, $sql)){
            // redirect to unique page for this record
            $new_url = "/scripts/collectors-club-v3/resume.php?id=" . $content_uuid;
            header("Location:$new_url");
            exit();
            
        } else {
            echo '<div class="text-center">
            There was an error processing your application. Please return to the 
            homepage and try again.
            </div>';
        }

    }

    ?>

    <div class="container">

    </div>
    
</body>
</html>